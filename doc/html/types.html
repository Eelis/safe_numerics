<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<title>Types</title>
<link rel="stylesheet" href="boostbook.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.76.1">
<link rel="home" href="index.html" title="Safe Numerics">
<link rel="up" href="index.html" title="Safe Numerics">
<link rel="prev" href="concepts.html" title="Type Requirements">
<link rel="next" href="exception_safety.html" title="Exception Safety">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<table cellpadding="2" width="100%"><tr>
<td valign="top"><img href="index.html" height="164px" src="pre-boost.jpg" alt="Library Documentation Index"></td>
<td><h2>Safe Numerics</h2></td>
</tr></table>
<div class="spirit-nav">
<a accesskey="p" href="concepts.html"><img src="images/prev.png" alt="Prev"></a><a accesskey="u" href="index.html"><img src="images/up.png" alt="Up"></a><a accesskey="h" href="index.html"><img src="images/home.png" alt="Home"></a><a accesskey="n" href="exception_safety.html"><img src="images/next.png" alt="Next"></a>
</div>
<div class="section">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="safe_numerics.types"></a>Types</h2></div></div></div>
<div class="toc"><dl>
<dt><span class="section"><a href="types.html#safe_numerics.safe">safe&lt;T, PP, EP&gt;</a></span></dt>
<dt><span class="section"><a href="types.html#safe_numerics.safe_unsigned_range">safe_signed_range&lt;MIN, MAX, PP, EP&gt; and
  safe_unsigned_range&lt;MIN, MAX, PP, EP&gt;</a></span></dt>
<dt><span class="section"><a href="types.html#safe_numerics.promotion_policies">Promotion Policies</a></span></dt>
<dt><span class="section"><a href="types.html#safe_numerics.exception_policies">Exception Policies</a></span></dt>
</dl></div>
<div class="section">
<div class="titlepage"><div><div><h3 class="title">
<a name="safe_numerics.safe"></a>safe&lt;T, PP, EP&gt;</h3></div></div></div>
<div class="section">
<div class="titlepage"><div><div><h4 class="title">
<a name="idm236254784688"></a>Description</h4></div></div></div>
<p>A <code class="computeroutput">safe&lt;T, PP, EP&gt;</code> can be used anywhere a type T
    can be used. Any expression which uses this type is guarenteed to return
    an arithmetically correct value or trap in some way.</p>
</div>
<div class="section">
<div class="titlepage"><div><div><h4 class="title">
<a name="idm236254782752"></a>Notation</h4></div></div></div>
<div class="informaltable"><table class="table">
<colgroup>
<col align="left">
<col align="left">
</colgroup>
<thead><tr>
<th align="left">Symbol</th>
<th align="left">Description</th>
</tr></thead>
<tbody><tr>
<td align="left"><code class="computeroutput">T</code></td>
<td align="left">Underlying type from which a safe type is being
            derived</td>
</tr></tbody>
</table></div>
</div>
<div class="section">
<div class="titlepage"><div><div><h4 class="title">
<a name="idm236254775632"></a>Associated Types</h4></div></div></div>
<div class="informaltable"><table class="table">
<colgroup>
<col align="left">
<col align="left">
</colgroup>
<tbody>
<tr>
<td align="left"><code class="computeroutput">PP</code></td>
<td align="left">A type which specifes the result type of an expression
            using safe types. </td>
</tr>
<tr>
<td align="left"><code class="computeroutput">EP</code></td>
<td align="left">A type containing members which are called when a correct
            result cannot be returned</td>
</tr>
</tbody>
</table></div>
</div>
<div class="section">
<div class="titlepage"><div><div><h4 class="title">
<a name="idm236254768880"></a>Template Parameters</h4></div></div></div>
<div class="informaltable"><table class="table">
<colgroup>
<col>
<col align="left">
<col align="left">
</colgroup>
<thead><tr>
<th align="left">Parameter</th>
<th align="left">Type Requirements</th>
<th align="left">Description</th>
</tr></thead>
<tbody>
<tr>
<td><code class="computeroutput">T</code></td>
<td align="left"><a href="http://en.cppreference.com/w/cpp/types/is_integral" target="_top">Integer&lt;T&gt;</a></td>
<td align="left"><p>The underlying type. Currently only integer types
            supported</p></td>
</tr>
<tr>
<td><code class="computeroutput">PP</code></td>
<td align="left"><a class="link" href="concepts.html#safe_numerics.numeric" title="Numeric&lt;T&gt;"><a class="link" href="concepts.html#safe_numerics.promotion_policy" title="PromotionPolicy&lt;PP&gt;">PromotionPolicy&lt;PP&gt;</a></a></td>
<td align="left"><p>Default value is <a class="link" href="concepts.html#safe_numerics.promotion_policy.models.native">boost::numeric::native</a></p></td>
</tr>
<tr>
<td><code class="computeroutput">EP</code></td>
<td align="left"><a class="link" href="concepts.html#safe_numerics.numeric" title="Numeric&lt;T&gt;"><a class="link" href="concepts.html#safe_numerics.exception_policy" title="ExceptionPolicy&lt;EP&gt;">Exception
            Policy&lt;EP&gt;</a></a></td>
<td align="left"><p>Default value is <a class="link" href="concepts.html#safe_numerics.exception_policy.models.thow_exception">boost::throw_exception</a></p></td>
</tr>
</tbody>
</table></div>
<p>See examples below.</p>
</div>
<div class="section">
<div class="titlepage"><div><div><h4 class="title">
<a name="idm236254752992"></a>Model of</h4></div></div></div>
<p><a class="link" href="concepts.html#safe_numerics.numeric" title="Numeric&lt;T&gt;">Integer</a></p>
<p><a class="link" href="concepts.html#safe_numerics.safe_numeric_concept" title="SafeNumeric&lt;T&gt;">SafeNumeric</a></p>
</div>
<div class="section">
<div class="titlepage"><div><div><h4 class="title">
<a name="idm236254750752"></a>Valid Expressions</h4></div></div></div>
<p>Implements all expressions and only those expressions defined by the
    <a class="link" href="concepts.html#safe_numerics.safe_numeric_concept" title="SafeNumeric&lt;T&gt;">SafeNumeric</a> type
    requirements. This, the result type of such an expression will be another
    safe type. The actual type of the result of such an expression will depend
    upon the specific promotion policy template parameter.</p>
</div>
<div class="section">
<div class="titlepage"><div><div><h4 class="title">
<a name="idm236254748688"></a>Header</h4></div></div></div>
<p><code class="filename"><a href="../../include/safe_integer.hpp" target="_top">#include
    &lt;boost/safe_numerics/safe_integer.hpp&gt;</a></code></p>
</div>
<div class="section">
<div class="titlepage"><div><div><h4 class="title">
<a name="idm236254746688"></a>Examples of use</h4></div></div></div>
<p>The most common usage would be safe&lt;T&gt; which uses the default
    promotion and exception policies. This type is meant to be a "drop-in"
    replacement of the intrinsic integer types. That is, expressions involving
    these types will be evaluated into result types which reflect the standard
    rules for evaluation of C++ expressions. Should it occur that such
    evaluation cannot return a correct result, an exception will be
    thrown.</p>
<p>There are two aspects of the operation of this type which can be
    customized with a policy. The first is the result type of an arithmetic
    operation. C++ defines the rules which define this result type in terms of
    the constintuent types of the operation. Here we refer to these rules a
    "type promotion" rules. These rules will sometimes result in a type which
    cannot hold the actual arithmetic result of the operation. This is the
    main motivation for making this library in the first place. One way to
    deal with this problem is to substitute our own type promotion rules for
    the C++ ones.</p>
<div class="section">
<div class="titlepage"><div><div><h5 class="title">
<a name="idm236254743600"></a>Drop-in replacement for standard integer type.</h5></div></div></div>
<p>The following program will throw an exception and emit a error
      message at runtime if any of several events result in an incorrect
      arithmetic type. Behavior of this program could vary according to the
      machine architecture in question.</p>
<pre class="programlisting">#include &lt;iostream&gt;
#include &lt;stdexcept&gt; // std::runtime_error
#include &lt;boost/numeric/safe.hpp&gt;

void f(){
    safe&lt;int&gt; j;
    try {
        safe&lt;int&gt; i;
        std::cin &gt;&gt; i;  // could overflow !
        j = i * i;      // could overflow
    }
    catch(std::runtime_error &amp; re){
       std::cout &lt;&lt; re.what() &lt;&lt; std::endl;
    }
    std::cout &lt;&lt; j;
}</pre>
</div>
<div class="section">
<div class="titlepage"><div><div><h5 class="title">
<a name="idm236254740672"></a>Guarantee correct behavior at compile time.</h5></div></div></div>
<p>In some instance catching an error at run time is not sufficient.
      We want to be sure that the program can never fail. To achieve this, use
      the trap_exception exception policy rather than the default throw
      exception policy.</p>
<p>The following program will emit a compile error at any statement
      which might possibly result in incorrect behavior. </p>
<p>This is because there is no way to guarantee that the expression i
      * i will return an arithmetically correct result. Since we know that the
      program cannot compile if there is any possibility of arithmetic error,
      we can dispense with the exception handling used above.</p>
<pre class="programlisting">#include &lt;boost/numeric/safe.hpp&gt;
#include &lt;iostream&gt;
void f(){
    using safe_int = safe&lt;int, boost::numeric::native, boost::numeric::trap_exception&gt;t; 
    safe_int i;
    std::cin &gt;&gt; i;  // could throw exception here !!!
    safe_int j;
    j = i * i; // could throw exception here !!!
}</pre>
</div>
<div class="section">
<div class="titlepage"><div><div><h5 class="title">
<a name="idm236254736656"></a>Adjust type promotion rules.</h5></div></div></div>
<p>Another way to avoid arithmetic errors like overflow is to promote
      types to larger sizes before doing the arithmetic. This can be justified
      by the observ</p>
<p>Stepping back, we can see that many of the cases of invalid
      arithmetic are wouldn't exist if results types were larger. So we can
      avoid these problems by replacing the C++ type promotion rules for
      expressions with our own rules. This can be done by specifying a
      non-default type promotion policy automatic. The policy stores the
      result of an expression in the smallest size that can accomodate the
      largest value that an expression can yield. All the work is done at
      compile time - checking for exceptions necessary (input is of course an
      exception). The following example illustrates this.</p>
<pre class="programlisting">#include &lt;boost/numeric/safe.hpp&gt;
#include &lt;iostream&gt;
void f(){
    using safe_int = safe&lt;int, boost::numeric::automatic, boost::numeric::throw_exception&gt;; 
    safe_int i;
    std::cin &gt;&gt; i; // might throw exception
    auto j = i * i; // won't ever trap - result type can hold the maximum value of i * i
    static_assert(boost::numeric::is_safe&lt;decltype(j)&gt;::value); // result is another safe type
    static_assert(
        std::numeric_limits&lt;decltype(i * i)&gt;::max() &gt;=
        std::numeric_limits&lt;safe_int&gt;::max() * std::numeric_limits&lt;safe_int&gt;::max()
    ); // always true
}</pre>
</div>
</div>
</div>
<div class="section">
<div class="titlepage"><div><div><h3 class="title">
<a name="safe_numerics.safe_unsigned_range"></a>safe_signed_range&lt;MIN, MAX, PP, EP&gt; and
  safe_unsigned_range&lt;MIN, MAX, PP, EP&gt;</h3></div></div></div>
<div class="section">
<div class="titlepage"><div><div><h4 class="title">
<a name="idm236254731600"></a>Description</h4></div></div></div>
<p>This type holds a signed or unsigned integer in the closed range
    [MIN, MAX]. A <code class="computeroutput">safe_signed_range&lt;MIN, MAX, PP, EP&gt;</code> or
    <code class="computeroutput">safe_unsigned_range&lt;MIN, MAX, PP, EP&gt;</code> can be used
    anywhere an arithmetic type is permitted. Any expression which uses either
    of these types is guarenteed to return an arithmetically correct value or
    trap in some way.</p>
</div>
<div class="section">
<div class="titlepage"><div><div><h4 class="title">
<a name="idm236254728944"></a>Notation</h4></div></div></div>
<div class="informaltable"><table class="table">
<colgroup>
<col align="left">
<col align="left">
</colgroup>
<thead><tr>
<th align="left">Symbol</th>
<th align="left">Description</th>
</tr></thead>
<tbody><tr>
<td align="left"><code class="computeroutput">MIN, MAX</code></td>
<td align="left">Minimum and maximum values that the range can
            represent.</td>
</tr></tbody>
</table></div>
</div>
<div class="section">
<div class="titlepage"><div><div><h4 class="title">
<a name="idm236254721904"></a>Associated Types</h4></div></div></div>
<div class="informaltable"><table class="table">
<colgroup>
<col align="left">
<col align="left">
</colgroup>
<tbody>
<tr>
<td align="left"><code class="computeroutput">PP</code></td>
<td align="left">Promotion Pollicy. A type which specifes the result type of
            an expression using safe types.</td>
</tr>
<tr>
<td align="left"><code class="computeroutput">EP</code></td>
<td align="left">Exception Policy. A type containing members which are
            called when a correct result cannot be returned</td>
</tr>
</tbody>
</table></div>
</div>
<div class="section">
<div class="titlepage"><div><div><h4 class="title">
<a name="idm236254715104"></a>Template Parameters</h4></div></div></div>
<div class="informaltable"><table class="table">
<colgroup>
<col align="left">
<col align="left">
<col align="left">
</colgroup>
<thead><tr>
<th align="left">Parameter</th>
<th align="left">Requirements</th>
<th align="left">Description</th>
</tr></thead>
<tbody>
<tr>
<td align="left"><code class="computeroutput">MIN</code></td>
<td align="left">must be non-integer literal</td>
<td align="left">The minimum non-negative integer value that this type may
            hold</td>
</tr>
<tr>
<td align="left"><code class="computeroutput">MAX</code></td>
<td align="left">must be a non-negative literal</td>
<td align="left">The maximum non-negative integer value that this type may
            hold</td>
</tr>
<tr>
<td align="left">&#160;</td>
<td align="left">MIN &lt;= MAX</td>
<td align="left">must be a valid closed range</td>
</tr>
<tr>
<td align="left"><code class="computeroutput">PP</code></td>
<td align="left"><a class="link" href="concepts.html#safe_numerics.numeric" title="Numeric&lt;T&gt;"><a class="link" href="concepts.html#safe_numerics.promotion_policy" title="PromotionPolicy&lt;PP&gt;">PromotionPolicy&lt;PP&gt;</a></a></td>
<td align="left"><p>Default value is <a class="link" href="concepts.html#safe_numerics.promotion_policy.models.native">boost::numeric::native</a></p></td>
</tr>
<tr>
<td align="left"><code class="computeroutput">EP</code></td>
<td align="left"><a class="link" href="concepts.html#safe_numerics.numeric" title="Numeric&lt;T&gt;"><a class="link" href="concepts.html#safe_numerics.exception_policy" title="ExceptionPolicy&lt;EP&gt;">Exception
            Policy&lt;EP&gt;</a></a></td>
<td align="left"><p>Default value is <a class="link" href="concepts.html#safe_numerics.exception_policy.models.thow_exception">boost::throw_exception</a></p></td>
</tr>
</tbody>
</table></div>
</div>
<div class="section">
<div class="titlepage"><div><div><h4 class="title">
<a name="idm236254696608"></a>Model of</h4></div></div></div>
<p><a class="link" href="concepts.html#safe_numerics.numeric" title="Numeric&lt;T&gt;">Integer</a></p>
<p><a class="link" href="concepts.html#safe_numerics.safe_numeric_concept" title="SafeNumeric&lt;T&gt;">SafeNumeric</a></p>
</div>
<div class="section">
<div class="titlepage"><div><div><h4 class="title">
<a name="idm236254694368"></a>Valid Expressions</h4></div></div></div>
<p>Implements all expressions and only those expressions defined by the
    <a class="link" href="concepts.html#safe_numerics.safe_numeric_concept" title="SafeNumeric&lt;T&gt;">SafeNumeric</a> type
    requirements. This, the result type of such an expression will be another
    safe type. The actual type of the result of such an expression will depend
    upon the specific promotion policy template parameter.</p>
</div>
<div class="section">
<div class="titlepage"><div><div><h4 class="title">
<a name="idm236254692304"></a>Header</h4></div></div></div>
<p><code class="filename"><a href="../../include/safe_range.hpp" target="_top">#include
    &lt;safe/numeric/safe_range.hpp&gt;</a></code></p>
</div>
<div class="section">
<div class="titlepage"><div><div><h4 class="title">
<a name="idm236254690320"></a>Example of use</h4></div></div></div>
<pre class="programlisting">#include &lt;safe/numeric/safe_range.hpp&gt;

void f(boost::numeric::safe_unsigned_range&lt;7, 24&gt; i){
    // since the range is included in [0,255], the underlying type of i 
    // will be an unsigned char.
    i = 0;  // throws out_of_range exception
    i = 9;  // ok
    i *= 9; // throws out_of_range exception
    i = -1; // throws out_of_range exception
    std::uint8_t j = 4;
    auto k = i + j;
        // These types use default promotion policy so standard C++ type promotion rules 
        // will be used in evaluating expressions.   C++ type promotion rules mandate
        // that the result of k = i + j when both are unsigned char types, will be another
        // unsigned char type.
  }</pre>
</div>
</div>
<div class="section">
<div class="titlepage"><div><div><h3 class="title">
<a name="safe_numerics.promotion_policies"></a>Promotion Policies</h3></div></div></div>
<div class="section">
<div class="titlepage"><div><div><h4 class="title">
<a name="safe_numerics.native_policy"></a>native</h4></div></div></div>
<div class="section">
<div class="titlepage"><div><div><h5 class="title">
<a name="idm236254687072"></a>Description</h5></div></div></div>
<p>This type contains the functions to return a safe type corresponding
    to the C++ type resulting for a given arithmetic operation.</p>
<p>Usage of this policy with safe types will produce the exact same
    arithmetic results that using normal unsafe integer types will. Hence this
    policy is suitable as a drop-in replacement for these unsafe types. It's
    main function is to trap incorrect arithmetic results when using C++ for
    integer arithmetic.</p>
</div>
<div class="section">
<div class="titlepage"><div><div><h5 class="title">
<a name="idm236254685056"></a>Model of</h5></div></div></div>
<p><a class="link" href="concepts.html#promotion_policy">PromotionPolicy</a></p>
<p>As an example of how this works consider C++ rules from section 5 of
    the standard - "usual arithmetic conversions".</p>
<pre class="programlisting">void int f(int x, int y){
    auto z = x + y; // z will be of type "int"
    return z;
}</pre>
<p>According to these rules, z will be of type int. Depending on the
    values of x and y, z may or may not contain the correct arithmetic result
    of the operation x + y.</p>
<pre class="programlisting">using safe_int = safe&lt;int, native&gt;;
void int f(safe_int x, safe_int y){
    auto z = x + y; // z will be of type "safe_int"
    return z;
}</pre>
</div>
<div class="section">
<div class="titlepage"><div><div><h5 class="title">
<a name="idm236254680736"></a>Header</h5></div></div></div>
<p><code class="computeroutput"><a href="../../include/native.hpp" target="_top"><code class="computeroutput">#include
    &lt;boost/safe_numerics/native.hpp&gt; </code></a></code></p>
</div>
<div class="section">
<div class="titlepage"><div><div><h5 class="title">
<a name="idm236254678400"></a>Example of use</h5></div></div></div>
<p>The following example illustrates the <code class="computeroutput">native</code> type being
    passed as a template parameter for the type <code class="computeroutput">safe&lt;int&gt;</code>.
    This example is slightly contrived in that <code class="computeroutput">safe&lt;int&gt;</code>
    has <code class="computeroutput">native</code> as it's default promotion parameter so explictiy
    using <code class="computeroutput">native</code> is not necessary.</p>
<pre class="programlisting">#include &lt;cassert&gt;
#include &lt;boost/safe_numerics/safe_integer.hpp&gt; 
#include &lt;boost/safe_numerics/native.hpp&gt; 
int main(){
    using namespace boost::numeric;
    // use native promotion policy where C++ standard arithmetic might lead to incorrect results
    using safe_int8 = safe&lt;std::int8_t, native&gt;;
    try{
        safe_int8 x = 127;
        safe_int8 y = 2;
        safe_int8 z;
        // rather than producing and invalid result an exception is thrown
        z = x + y;
        assert(false); // never arrive here
    }
    catch(std::exception &amp; e){
        // which can catch here
        std::cout &lt;&lt; e.what() &lt;&lt; std::endl;
    }

    // When result is an int, C++ promotion rules guarentee that there will be no incorrect result.
    // In such cases, there is no runtime overhead from using safe types.
    safe_int8 x = 127;
    safe_int8 y = 2;
    safe&lt;int, native&gt; z; // z can now hold the result of the addition of any two 8 bit numbers
    z = x + y; // is guarenteed correct without any runtime overhead or interrupt.

    return 0;
}</pre>
</div>
<div class="section">
<div class="titlepage"><div><div><h5 class="title">
<a name="idm236254673200"></a>Notes</h5></div></div></div>
<p>See Chapter 5, Expressions, C++ Standard</p>
</div>
</div>
<div class="section">
<div class="titlepage"><div><div><h4 class="title">
<a name="safe_numerics.automatic"></a>automatic</h4></div></div></div>
<div class="section">
<div class="titlepage"><div><div><h5 class="title">
<a name="idm236254671296"></a>Description</h5></div></div></div>
<p>This type contains the functions to return a type with sufficient
    capacity to hold the result of a given arithmetic operation.</p>
</div>
<div class="section">
<div class="titlepage"><div><div><h5 class="title">
<a name="idm236254670000"></a>Model of</h5></div></div></div>
<p><a class="link" href="concepts.html#promotion_policy">PromotionPolicy</a></p>
</div>
<div class="section">
<div class="titlepage"><div><div><h5 class="title">
<a name="idm236254668496"></a>Header</h5></div></div></div>
<p><code class="computeroutput"><a href="../../include/automatic.hpp" target="_top"><code class="computeroutput">#include
    &lt;boost/safe_numerics/automatic.hpp&gt; </code></a></code></p>
</div>
<div class="section">
<div class="titlepage"><div><div><h5 class="title">
<a name="idm236254666160"></a>Example of use</h5></div></div></div>
<p>The following example illustrates the <code class="computeroutput">automatic</code> type
    being passed as a template parameter for the type
    <code class="computeroutput">safe&lt;int&gt;</code>. This example is slightly contrived in that
    <code class="computeroutput">safe&lt;int&gt;</code> has <code class="computeroutput">native</code> as it's default
    promotion parameter so explictiy using <code class="computeroutput">native</code> is not
    necessary.</p>
<pre class="programlisting">#include &lt;cassert&gt;
#include &lt;boost/safe_numerics/safe_integer.hpp&gt; 
#include &lt;boost/safe_numerics/native.hpp&gt; 
int main(){
    using namespace boost::numeric;
    // use automatic promotion policy where C++ standard arithmetic might lead to incorrect results
    using safe_int8 = safe&lt;std::int8_t, automatic&gt;;
    try{
        safe_int8 x = 127;
        safe_int8 y = 2;
        auto z = x + y; // z will be of safe type at least 9 bits long
    }
    catch(std::exception &amp; e){
        // which can catch here only if
        std::cout &lt;&lt; e.what() &lt;&lt; std::endl;
    }

    // When result is an int, C++ promotion rules guarentee that there will be no incorrect result.
    // In such cases, there is no runtime overhead from using safe types.
    safe_int8 x = 127;
    safe_int8 y = 2;
    safe&lt;int, native&gt; z; // z can now hold the result of the addition of any two 8 bit numbers
    z = x + y; // is guarenteed correct without any runtime overhead or interrupt.

    return 0;
}</pre>
</div>
</div>
<div class="section">
<div class="titlepage"><div><div><h4 class="title">
<a name="safe_numerics.cpp"></a>cpp&lt;int C, int S, int I, int L, int LL&gt;</h4></div></div></div>
<div class="section">
<div class="titlepage"><div><div><h5 class="title">
<a name="idm236254660032"></a>Description</h5></div></div></div>
<p>This policy is used to promote safe types in arithmetic expressions
    according the the standard rules in the C++ standard. But rather than
    using the native C++ standard types supported by the compiler, it uses
    types whose length in number of bits is specified by the template
    parameters.</p>
<p>This policy is useful for running test program which use C++
    portable integer types but which are destined to run on an an architecture
    which is different than the one on which the test program is being built
    and run. This can happen when developing code for embedded systems.
    Algorithms developed or borrowed from one architecture but destined for
    another can be tested on ib the desk top.</p>
</div>
<div class="section">
<div class="titlepage"><div><div><h5 class="title">
<a name="idm236254657776"></a>Template Parameters</h5></div></div></div>
<div class="informaltable"><table class="table">
<colgroup>
<col align="left">
<col align="left">
<col align="left">
</colgroup>
<thead><tr>
<th align="left">Parameter</th>
<th align="left">Type</th>
<th align="left">Description</th>
</tr></thead>
<tbody>
<tr>
<td align="left"><code class="computeroutput">C</code></td>
<td align="left">int</td>
<td align="left">Number of bits in a char</td>
</tr>
<tr>
<td align="left"><code class="computeroutput">S</code></td>
<td align="left">int</td>
<td align="left">Number of bits in a short</td>
</tr>
<tr>
<td align="left"><code class="computeroutput">I</code></td>
<td align="left">int</td>
<td align="left">Number of bits in an integer</td>
</tr>
<tr>
<td align="left"><code class="computeroutput">L</code></td>
<td align="left">int</td>
<td align="left">Number of bits in a long</td>
</tr>
<tr>
<td align="left"><code class="computeroutput">LL</code></td>
<td align="left">int</td>
<td align="left">Number of bits in a long long</td>
</tr>
</tbody>
</table></div>
</div>
<div class="section">
<div class="titlepage"><div><div><h5 class="title">
<a name="idm236254641712"></a>Model of</h5></div></div></div>
<p><a class="link" href="concepts.html#safe_numerics.promotion_policy" title="PromotionPolicy&lt;PP&gt;">PromotionPolicy</a></p>
</div>
<div class="section">
<div class="titlepage"><div><div><h5 class="title">
<a name="idm236254640208"></a>Header</h5></div></div></div>
<p><code class="computeroutput"><a href="../../examples/example9.cpp" target="_top"><code class="computeroutput">#include
    &lt;boost/safe_numerics/cpp.hpp&gt; </code></a></code></p>
</div>
<div class="section">
<div class="titlepage"><div><div><h5 class="title">
<a name="idm236254637872"></a>Example of Use</h5></div></div></div>
<p>Consider the following problem. One is developing software which
    uses a very small microprocessor and a very limited C compiler. The chip
    is so small, you can't print anything from the code, log, debug or
    anything else. One debugs this code by using the "burn" and "crash" method
    - you burn the chip (download the code) run the code, observe the results,
    make changes and try again. This is a crude method which is usually the
    one used. But it can be quite time consuming.</p>
<p>Consider an alternative. Build and compile your code in testable
    modules. For each module write a test which excercises all the code and
    makes it work. Finally download your code into the chip and - voila -
    working product. This sounds great, but there's one problem. Our target
    processor - in this case a PIC162550 from Microchip Technology is only an
    8 bit CPU. The compiler we use defines INT as 8 bits. This (and a few
    other problems), make our algorithm testing environment differ from our
    target environment. We can address this by defining INT as a safe integer
    with a range of 8 bits. By using a custom promotion policy, we can force
    the evaluation of C++ expressions test environment to be the same as that
    in the target environment. Also in our target environment, we can trap any
    overflows or other errors. So we can write and test our code on our
    desktop system and download the code to the target knowing that it just
    has to work. This is a huge time saver and confidence builder. The
    following code is taken from a real project which has used this
    method.</p>
<pre class="programlisting">#include "../include/safe_integer.hpp"
#include "../include/cpp.hpp"

//////////////////////////////////////////////////////////////
// Stepper Motor Control

// emululate evironment for pic162550
// data widths used by the CCS compiler for pic 16xxx series

using pic16_promotion = boost::numeric::cpp&lt;
    8,  // char
    8,  // short - not used by pic 16xxxx
    8,  // int
    16, // long
    32  // long long
&gt;;

template &lt;typename T&gt; // T is char, int, etc data type
using safe_t = boost::numeric::safe&lt;
    T,
    pic16_promotion,
    boost::numeric::trap_exception // use for compiling and running tests
&gt;;

using int8 = safe_t&lt;std::int8_t&gt;;
using int16 = safe_t&lt;std::int16_t&gt;;
using int32 = safe_t&lt;std::int32_t&gt;;
using uint8 = safe_t&lt;std::uint8_t&gt;;
using uint16 = safe_t&lt;std::uint16_t&gt;;
using uint32 = safe_t&lt;std::uint32_t&gt;;

////////////////////////////////////////////////////////////////
// Mock defines, functions etc which are in he "real application

...

// return value in steps
/*
Use the formula:
    stopping dist = v **2 / a / 2
*/
uint16 get_stopping_distance(LEMPARAMETER velocity){
    int32 d;
    d = velocity;
    d *= velocity;
    d /= lem.acceleration;
    d /= 2;
    return d;
}

...</pre>
<p>Note the usage of the compile time trap policy in order to detect at
    compile time any possible error conditions. As I write this, this is still
    being refined. Hopefully this will be available by the time you read this.
    This example is too long to include in line in this documentation. You can
    see the whole file at <a href="../../include/cpp.hpp" target="_top"><code class="computeroutput">example.cpp</code></a></p>
</div>
</div>
</div>
<div class="section">
<div class="titlepage"><div><div><h3 class="title">
<a name="safe_numerics.exception_policies"></a>Exception Policies</h3></div></div></div>
<div class="section">
<div class="titlepage"><div><div><h4 class="title">
<a name="idm236254632480"></a>throw_exception</h4></div></div></div>
<div class="section">
<div class="titlepage"><div><div><h5 class="title">
<a name="idm236254631840"></a>Description</h5></div></div></div>
<p>This exception policy throws a an exception derived from
    <code class="computeroutput">std::exception</code> any time some operation would result in an
    incorrect result. This is the default exception handling policy.</p>
</div>
<div class="section">
<div class="titlepage"><div><div><h5 class="title">
<a name="idm236254629952"></a>Model of</h5></div></div></div>
<p><a class="link" href="concepts.html#safe_numerics.promotion_policy" title="PromotionPolicy&lt;PP&gt;">ExceptionPolicy</a></p>
</div>
<div class="section">
<div class="titlepage"><div><div><h5 class="title">
<a name="idm236254628448"></a>Header</h5></div></div></div>
<p><code class="computeroutput"><a href="../../include/exception_policy.hpp" target="_top"><code class="computeroutput">#include
    &lt;boost/safe_numerics/exception_policies.hpp&gt;
    </code></a></code></p>
</div>
<div class="section">
<div class="titlepage"><div><div><h5 class="title">
<a name="idm236254626096"></a>Example of use</h5></div></div></div>
<p>This example is somewhat contrived as throw_exception is the default
    for safe types. Hence it usually is not necessarily to request it
    explicitly.</p>
<pre class="programlisting">#include "../../include/safe_integer.hpp"
#include "../../include/exception_policies" // exception policies
#include "../../include/native"             // native promotion policy

int main(){
    using namespace boost::numeric;
    safe&lt;int, native, throw_exception&gt; i;
    int j = 0;
    i /= j;   // throws exception
}</pre>
</div>
</div>
<div class="section">
<div class="titlepage"><div><div><h4 class="title">
<a name="idm236254623328"></a>ignore_exception</h4></div></div></div>
<div class="section">
<div class="titlepage"><div><div><h5 class="title">
<a name="idm236254622592"></a>Description</h5></div></div></div>
<p>This exception policy can be used to just ignore conditions which
    generate incorrect arithmetic results and continue processing. Programs
    using this policy along with the <a class="link" href="types.html#safe_numerics.native_policy" title="native">native</a> promotion policy
    should function as if the library is not even being used.</p>
</div>
<div class="section">
<div class="titlepage"><div><div><h5 class="title">
<a name="idm236254620656"></a>Model of</h5></div></div></div>
<p><a class="link" href="concepts.html#safe_numerics.promotion_policy" title="PromotionPolicy&lt;PP&gt;">ExceptionPolicy</a></p>
</div>
<div class="section">
<div class="titlepage"><div><div><h5 class="title">
<a name="idm236254619152"></a>Header</h5></div></div></div>
<p><code class="computeroutput"><a href="../../include/exception_policy.hpp" target="_top"><code class="computeroutput">#include
    &lt;boost/safe_numerics/exception_policy.hpp&gt;
    </code></a></code></p>
</div>
<div class="section">
<div class="titlepage"><div><div><h5 class="title">
<a name="idm236254616800"></a>Example of use</h5></div></div></div>
<pre class="programlisting">safe&lt;int, native, ignore_exception&gt; st(4);</pre>
</div>
</div>
<div class="section">
<div class="titlepage"><div><div><h4 class="title">
<a name="idm236254615200"></a>no_exception_support&lt;O, U = O, R =O, D = O&gt;</h4></div></div></div>
<div class="section">
<div class="titlepage"><div><div><h5 class="title">
<a name="idm236254614560"></a>Description</h5></div></div></div>
<p>This exception policy can be used in an environment where one cannot
    or does not want to use exceptions.</p>
<p>Parameters are pointers to static functions which are invoked for
    each kind of error encountered in the library. The function signature of
    these functions are <code class="computeroutput">void function(const char * message)</code> where
    <code class="computeroutput">message</code> is the address of a literal string with information
    regarding the error.</p>
</div>
<div class="section">
<div class="titlepage"><div><div><h5 class="title">
<a name="idm236254611440"></a>Template Parameters</h5></div></div></div>
<p>Function objects to be invoked are specified for each error
    condition are specified via template parameters.</p>
<div class="informaltable"><table class="table">
<colgroup>
<col align="left">
<col align="left">
<col align="left">
<col align="left">
</colgroup>
<thead><tr>
<th align="left">Parameter</th>
<th align="left">Default</th>
<th align="left">Type Requirements</th>
<th align="left">Description</th>
</tr></thead>
<tbody>
<tr>
<td align="left"><code class="computeroutput">O</code></td>
<td align="left"><code class="computeroutput"></code></td>
<td align="left">void (*O)(const char *)</td>
<td align="left"><p>Function to call on overflow error</p></td>
</tr>
<tr>
<td align="left"><code class="computeroutput">O</code></td>
<td align="left"><code class="computeroutput">O</code></td>
<td align="left">void (*U)(const char *)</td>
<td align="left"><p>Function to call on underflow error</p></td>
</tr>
<tr>
<td align="left"><code class="computeroutput">O</code></td>
<td align="left"><code class="computeroutput">O</code></td>
<td align="left">void (*R)(const char *)</td>
<td align="left"><p>Function to call on range error</p></td>
</tr>
<tr>
<td align="left"><code class="computeroutput">O</code></td>
<td align="left"><code class="computeroutput">O</code></td>
<td align="left">void (*D)(const char *)</td>
<td align="left"><p>Function to call on domain error</p></td>
</tr>
</tbody>
</table></div>
</div>
<div class="section">
<div class="titlepage"><div><div><h5 class="title">
<a name="idm236254592784"></a>Model of</h5></div></div></div>
<p><a class="link" href="concepts.html#safe_numerics.promotion_policy" title="PromotionPolicy&lt;PP&gt;">ExceptionPolicy</a></p>
</div>
<div class="section">
<div class="titlepage"><div><div><h5 class="title">
<a name="idm236254591280"></a>Header</h5></div></div></div>
<p><code class="computeroutput"><a href="../../include/exception_policy.hpp" target="_top"><code class="computeroutput">#include
    &lt;boost/safe_numerics/exception_policy.hpp&gt;
    </code></a></code></p>
</div>
<div class="section">
<div class="titlepage"><div><div><h5 class="title">
<a name="idm236254588928"></a>Example of use</h5></div></div></div>
<p>[A code fragment involving the type.]</p>
<pre class="programlisting">void overflow(const char * msg);
void underflow(const char * msg);
void range_error(const char * msg);
void domain_error(const char * msg);

using ep = ignore_exception&lt;
    overflow,
    underflow,
    range_error,
    domain_error
&gt;;

safe&lt;int, native, ep&gt; st(4);</pre>
</div>
</div>
<div class="section">
<div class="titlepage"><div><div><h4 class="title">
<a name="idm236254586512"></a>trap_exception</h4></div></div></div>
<div class="section">
<div class="titlepage"><div><div><h5 class="title">
<a name="idm236254585872"></a>Description</h5></div></div></div>
<p>This exception policy will trap at compile time any operation could
    result in a runtime exception. It can be used in an evironment which can
    tolerate neither arithmetic errors nor runtime overhead.</p>
</div>
<div class="section">
<div class="titlepage"><div><div><h5 class="title">
<a name="idm236254584512"></a>Model of</h5></div></div></div>
<p><a class="link" href="concepts.html#safe_numerics.promotion_policy" title="PromotionPolicy&lt;PP&gt;">ExceptionPolicy</a></p>
</div>
<div class="section">
<div class="titlepage"><div><div><h5 class="title">
<a name="idm236254583136"></a>Header</h5></div></div></div>
<p><code class="computeroutput"><a href="../../include/exception_policy.hpp" target="_top"><code class="computeroutput">#include
    &lt;boost/safe_numerics/exception_policy.hpp&gt;
    </code></a></code></p>
</div>
<div class="section">
<div class="titlepage"><div><div><h5 class="title">
<a name="idm236254580784"></a>Example of use</h5></div></div></div>
<p>The following </p>
<pre class="programlisting">#include "../../include/safe_integer.hpp"
#include "../../include/automatic.hpp"
#include "../../include/exception_policies.hpp"

int main(){
    using namespace boost::numeric;
    safe&lt;char, automatic, trap_exception&gt; x, y;
    y = x * x; // compile error here !!!
    auto z = x * x; // compile OK
    return 0;
}</pre>
</div>
</div>
</div>
</div>
<table xmlns:rev="http://www.cs.rpi.edu/~gregod/boost/tools/doc/revision" width="100%"><tr>
<td align="left"></td>
<td align="right"><div class="copyright-footer">Copyright &#169; 2012 Robert Ramey<p><a href="http://www.boost.org/LICENSE_1_0.txt" target="_top">Subject to Boost
      Software License</a></p>
</div></td>
</tr></table>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="concepts.html"><img src="images/prev.png" alt="Prev"></a><a accesskey="u" href="index.html"><img src="images/up.png" alt="Up"></a><a accesskey="h" href="index.html"><img src="images/home.png" alt="Home"></a><a accesskey="n" href="exception_safety.html"><img src="images/next.png" alt="Next"></a>
</div>
</body>
</html>
